name: Validate HTML/CSS and Links

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  validate_html:
    name: Validate HTML/CSS and Links
    runs-on: ubuntu-latest
    needs: terraform

    env:
      HTML_FILES_PATH: "./webpage/html5-boilerplate-main/dist"
      CSS_FILES_PATH: "./webpage/html5-boilerplate-main/dist"

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Download Terraform Outputs
        uses: actions/download-artifact@v4
        with:
          name: terraform-outputs

      - name: Install tidy
        run: sudo apt-get update && sudo apt-get install -y tidy

      - name: Install stylelint
        run: |
          npm install -g stylelint
          npm install -g stylelint-config-standard

      - name: Validate HTML Files
        run: |
          for file in $(find $HTML_FILES_PATH -name "*.html"); do
            tidy -q -e "$file"
          done

      - name: Validate CSS Files
        run: |
          for file in $(find $CSS_FILES_PATH -name "*.css"); do
            stylelint "$file"
          done

      - name: Check Links in HTML
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          folder: ${{ env.HTML_FILES_PATH }}
